(()=>{var v=s=>{if("flags"in s){let e=R(s.flags),t=Y(s.flags);return{...s,featureFlags:e,featureFlagPayloads:t}}{let e=s.featureFlags??{},t=Object.fromEntries(Object.entries(s.featureFlagPayloads||{}).map(([i,n])=>[i,N(n)])),r=Object.fromEntries(Object.entries(e).map(([i,n])=>[i,Ke(i,n,t[i])]));return{...s,featureFlags:e,featureFlagPayloads:t,flags:r}}};function Ke(s,e,t){return{key:s,enabled:typeof e=="string"?!0:e,variant:typeof e=="string"?e:void 0,reason:void 0,metadata:{id:void 0,version:void 0,payload:t?JSON.stringify(t):void 0,description:void 0}}}var R=s=>Object.fromEntries(Object.entries(s??{}).map(([e,t])=>[e,E(t)]).filter(([,e])=>e!==void 0)),Y=s=>{let e=s??{};return Object.fromEntries(Object.keys(e).filter(t=>{let r=e[t];return r.enabled&&r.metadata&&r.metadata.payload!==void 0}).map(t=>{let r=e[t].metadata?.payload;return[t,r?N(r):void 0]}))};var E=s=>s===void 0?void 0:s.variant??s.enabled,N=s=>{if(typeof s!="string")return s;try{return JSON.parse(s)}catch{return s}},Z=(s,e)=>{let i={featureFlags:[...new Set([...Object.keys(s??{}),...Object.keys(e??{})])].filter(n=>!!s[n]||!!e[n]).reduce((n,o)=>(n[o]=s[o]??!0,n),{}),featureFlagPayloads:e??{}};return v(i)},_e=(s,e)=>({...s,enabled:ee(e),variant:te(e)});function ee(s){return typeof s=="string"?!0:s}function te(s){return typeof s=="string"?s:void 0}var A="0123456789abcdef",D=class s{constructor(e){this.bytes=e}static ofInner(e){if(e.length===16)return new s(e);throw new TypeError("not 128-bit length")}static fromFieldsV7(e,t,r,i){if(!Number.isInteger(e)||!Number.isInteger(t)||!Number.isInteger(r)||!Number.isInteger(i)||e<0||t<0||r<0||i<0||e>0xffffffffffff||t>4095||r>1073741823||i>4294967295)throw new RangeError("invalid field value");let n=new Uint8Array(16);return n[0]=e/2**40,n[1]=e/2**32,n[2]=e/2**24,n[3]=e/2**16,n[4]=e/256,n[5]=e,n[6]=112|t>>>8,n[7]=t,n[8]=128|r>>>24,n[9]=r>>>16,n[10]=r>>>8,n[11]=r,n[12]=i>>>24,n[13]=i>>>16,n[14]=i>>>8,n[15]=i,new s(n)}static parse(e){let t;switch(e.length){case 32:t=/^[0-9a-f]{32}$/i.exec(e)?.[0];break;case 36:t=/^([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})$/i.exec(e)?.slice(1,6).join("");break;case 38:t=/^\{([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})\}$/i.exec(e)?.slice(1,6).join("");break;case 45:t=/^urn:uuid:([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})$/i.exec(e)?.slice(1,6).join("");break;default:break}if(t){let r=new Uint8Array(16);for(let i=0;i<16;i+=4){let n=parseInt(t.substring(2*i,2*i+8),16);r[i+0]=n>>>24,r[i+1]=n>>>16,r[i+2]=n>>>8,r[i+3]=n}return new s(r)}throw new SyntaxError("could not parse UUID string")}toString(){let e="";for(let t=0;t<this.bytes.length;t++)e+=A.charAt(this.bytes[t]>>>4),e+=A.charAt(15&this.bytes[t]),(t===3||t===5||t===7||t===9)&&(e+="-");return e}toHex(){let e="";for(let t=0;t<this.bytes.length;t++)e+=A.charAt(this.bytes[t]>>>4),e+=A.charAt(15&this.bytes[t]);return e}toJSON(){return this.toString()}getVariant(){let e=this.bytes[8]>>>4;if(e<0)throw new Error("unreachable");if(e<=7)return this.bytes.every(t=>t===0)?"NIL":"VAR_0";if(e<=11)return"VAR_10";if(e<=13)return"VAR_110";if(e<=15)return this.bytes.every(t=>t===255)?"MAX":"VAR_RESERVED";throw new Error("unreachable")}getVersion(){return this.getVariant()==="VAR_10"?this.bytes[6]>>>4:void 0}clone(){return new s(this.bytes.slice(0))}equals(e){return this.compareTo(e)===0}compareTo(e){for(let t=0;t<16;t++){let r=this.bytes[t]-e.bytes[t];if(r!==0)return Math.sign(r)}return 0}},se=class{constructor(e){this.timestamp=0,this.counter=0,this.random=e??Ve()}generate(){return this.generateOrResetCore(Date.now(),1e4)}generateOrAbort(){return this.generateOrAbortCore(Date.now(),1e4)}generateOrResetCore(e,t){let r=this.generateOrAbortCore(e,t);return r===void 0&&(this.timestamp=0,r=this.generateOrAbortCore(e,t)),r}generateOrAbortCore(e,t){if(!Number.isInteger(e)||e<1||e>0xffffffffffff)throw new RangeError("`unixTsMs` must be a 48-bit positive integer");if(t<0||t>0xffffffffffff)throw new RangeError("`rollbackAllowance` out of reasonable range");if(e>this.timestamp)this.timestamp=e,this.resetCounter();else{if(!(e+t>=this.timestamp))return;this.counter++,this.counter>4398046511103&&(this.timestamp++,this.resetCounter())}return D.fromFieldsV7(this.timestamp,Math.trunc(this.counter/2**30),this.counter&2**30-1,this.random.nextUint32())}resetCounter(){this.counter=1024*this.random.nextUint32()+(1023&this.random.nextUint32())}generateV4(){let e=new Uint8Array(Uint32Array.of(this.random.nextUint32(),this.random.nextUint32(),this.random.nextUint32(),this.random.nextUint32()).buffer);return e[6]=64|e[6]>>>4,e[8]=128|e[8]>>>2,D.ofInner(e)}},Ve=()=>({nextUint32:()=>65536*Math.trunc(65536*Math.random())+Math.trunc(65536*Math.random())}),Fe,y=()=>Xe().toString(),Xe=()=>(Fe||(Fe=new se)).generate();var a=(function(s){return s.AnonymousId="anonymous_id",s.DistinctId="distinct_id",s.Props="props",s.EnablePersonProcessing="enable_person_processing",s.PersonMode="person_mode",s.FeatureFlagDetails="feature_flag_details",s.FeatureFlags="feature_flags",s.FeatureFlagPayloads="feature_flag_payloads",s.BootstrapFeatureFlagDetails="bootstrap_feature_flag_details",s.BootstrapFeatureFlags="bootstrap_feature_flags",s.BootstrapFeatureFlagPayloads="bootstrap_feature_flag_payloads",s.OverrideFeatureFlags="override_feature_flags",s.Queue="queue",s.OptedOut="opted_out",s.SessionId="session_id",s.SessionStartTimestamp="session_start_timestamp",s.SessionLastTimestamp="session_timestamp",s.PersonProperties="person_properties",s.GroupProperties="group_properties",s.InstalledAppBuild="installed_app_build",s.InstalledAppVersion="installed_app_version",s.SessionReplay="session_replay",s.SurveyLastSeenDate="survey_last_seen_date",s.SurveysSeen="surveys_seen",s.Surveys="surveys",s.RemoteConfig="remote_config",s.FlagsEndpointWasHit="flags_endpoint_was_hit",s})({}),be=(function(s){return s.GZipJS="gzip-js",s.Base64="base64",s})({}),_={ERRORS_WHILE_COMPUTING:"errors_while_computing_flags",FLAG_MISSING:"flag_missing",QUOTA_LIMITED:"quota_limited",TIMEOUT:"timeout",CONNECTION_ERROR:"connection_error",UNKNOWN_ERROR:"unknown_error",apiError:s=>`api_error_${s}`};function T(s){return s===null||typeof s!="object"?s:Array.isArray(s)?s.map(T):Object.keys(s).sort().reduce((e,t)=>(e[t]=T(s[t]),e),{})}function re(s,e,t){return JSON.stringify({distinct_id:s,userPropertiesToSet:e?T(e):void 0,userPropertiesToSetOnce:t?T(t):void 0})}var Je=Array.isArray,Pe=Object.prototype,He=Pe.hasOwnProperty,Ye=Pe.toString,ve=Je||function(s){return Ye.call(s)==="[object Array]"};var M=s=>s===Object(s)&&!ve(s),ie=s=>{if(M(s)){for(let e in s)if(He.call(s,e))return!1;return!0}return!1},L=s=>s===void 0;var Ze=s=>s===null,ne=s=>L(s)||Ze(s);var B=s=>s instanceof Error;var j=class{add(e){let t=y();return this.promiseByIds[t]=e,e.catch(()=>{}).finally(()=>{delete this.promiseByIds[t]}),e}async join(){let e=Object.values(this.promiseByIds),t=e.length;for(;t>0;)await Promise.all(e),e=Object.values(this.promiseByIds),t=e.length}get length(){return Object.keys(this.promiseByIds).length}constructor(){this.promiseByIds={}}};function et(s=console){return{log:s.log.bind(s),warn:s.warn.bind(s),error:s.error.bind(s),debug:s.debug.bind(s)}}var Ee=(s,e,t)=>{function r(n,...o){e(()=>{let l=t[n];l(s,...o)})}return{info:(...n)=>{r("log",...n)},warn:(...n)=>{r("warn",...n)},error:(...n)=>{r("error",...n)},critical:(...n)=>{t.error(s,...n)},createLogger:n=>Ee(`${s} ${n}`,e,t)}},tt=s=>s();function we(s,e=tt){return Ee(s,e,et())}var x="Mobile",q="iOS",w="Android",xe="Tablet",ts=w+" "+xe;var st="Apple",ss=st+" Watch",Se="Safari",W="BlackBerry",Ie="Samsung",rt=Ie+"Browser",it=Ie+" Internet",z="Chrome",nt=z+" OS",ot=z+" "+q,Oe="Internet Explorer",at=Oe+" "+x,ae="Opera",rs=ae+" Mini",Re="Edge",lt="Microsoft "+Re,le="Firefox",ct=le+" "+q,ce="Nintendo",ue="PlayStation",U="Xbox",ut=w+" "+x,ft=x+" "+Se,C="Windows",ht=C+" Phone";var Ce="Generic",is=Ce+" "+x.toLowerCase(),ns=Ce+" "+xe.toLowerCase(),dt="Konqueror",g="(\\d+(\\.\\d+)?)",oe=new RegExp("Version/"+g),os=new RegExp(U,"i"),as=new RegExp(ue+" \\w+","i"),ls=new RegExp(ce+" \\w+","i"),gt=new RegExp(W+"|PlayBook|BB10","i"),pt={"NT3.51":"NT 3.11","NT4.0":"NT 4.0","5.0":"2000","5.1":"XP","5.2":"XP","6.0":"Vista","6.1":"7","6.2":"8","6.3":"8.1","6.4":"10","10.0":"10"};var cs={[at]:[new RegExp("rv:"+g)],[lt]:[new RegExp(Re+"?\\/"+g)],[z]:[new RegExp("("+z+"|CrMo)\\/"+g)],[ot]:[new RegExp("CriOS\\/"+g)],"UC Browser":[new RegExp("(UCBrowser|UCWEB)\\/"+g)],[Se]:[oe],[ft]:[oe],[ae]:[new RegExp("("+ae+"|OPR)\\/"+g)],[le]:[new RegExp(le+"\\/"+g)],[ct]:[new RegExp("FxiOS\\/"+g)],[dt]:[new RegExp("Konqueror[:/]?"+g,"i")],[W]:[new RegExp(W+" "+g),oe],[ut]:[new RegExp("android\\s"+g,"i")],[it]:[new RegExp(rt+"\\/"+g)],[Oe]:[new RegExp("(rv:|MSIE )"+g)],Mozilla:[new RegExp("rv:"+g)]};var us=[[new RegExp(U+"; "+U+" (.*?)[);]","i"),s=>[U,s&&s[1]||""]],[new RegExp(ce,"i"),[ce,""]],[new RegExp(ue,"i"),[ue,""]],[gt,[W,""]],[new RegExp(C,"i"),(s,e)=>{if(/Phone/.test(e)||/WPDesktop/.test(e))return[ht,""];if(new RegExp(x).test(e)&&!/IEMobile\b/.test(e))return[C+" "+x,""];let t=/Windows NT ([0-9.]+)/i.exec(e);if(t&&t[1]){let r=t[1],i=pt[r]||"";return/arm/i.test(e)&&(i="RT"),[C,i]}return[C,""]}],[/((iPhone|iPad|iPod).*?OS (\d+)_(\d+)_?(\d+)?|iPhone)/,s=>{if(s&&s[3]){let e=[s[3],s[4],s[5]||"0"];return[q,e.join(".")]}return[q,""]}],[/(watch.*\/(\d+\.\d+\.\d+)|watch os,(\d+\.\d+),)/i,s=>{let e="";return s&&s.length>=3&&(e=L(s[2])?s[3]:s[2]),["watchOS",e]}],[new RegExp("("+w+" (\\d+)\\.(\\d+)\\.?(\\d+)?|"+w+")","i"),s=>{if(s&&s[2]){let e=[s[2],s[3],s[4]||"0"];return[w,e.join(".")]}return[w,""]}],[/Mac OS X (\d+)[_.](\d+)[_.]?(\d+)?/i,s=>{let e=["Mac OS X",""];if(s&&s[1]){let t=[s[1],s[2],s[3]||"0"];e[1]=t.join(".")}return e}],[/Mac/i,["Mac OS X",""]],[/CrOS/,[nt,""]],[/Linux|debian/i,["Linux",""]]];var ke="utf8";function $e(s,e){if(!s||typeof s!="string"||mt(s))throw new Error(e)}function mt(s){return s.trim().length===0}function Ne(s){return s?.replace(/\/+$/,"")}async function Ae(s,e){let t=null;for(let r=0;r<e.retryCount+1;r++){r>0&&await new Promise(i=>setTimeout(i,e.retryDelay));try{return await s()}catch(i){if(t=i,!e.retryCheck(i))throw i}}throw t}function De(){return new Date().getTime()}function G(){return new Date().toISOString()}function fe(s,e){let t=setTimeout(s,e);return t?.unref&&t?.unref(),t}function Te(){return typeof fetch<"u"?fetch:globalThis.fetch!==void 0?globalThis.fetch:void 0}function he(s){return Promise.all(s.map(e=>(e??Promise.resolve()).then(t=>({status:"fulfilled",value:t}),t=>({status:"rejected",reason:t}))))}var K=class{constructor(){this.events={},this.events={}}on(e,t){return this.events[e]||(this.events[e]=[]),this.events[e].push(t),()=>{this.events[e]=this.events[e].filter(r=>r!==t)}}emit(e,t){for(let r of this.events[e]||[])r(t);for(let r of this.events["*"]||[])r(e,t)}};function Me(){return"CompressionStream"in globalThis}async function de(s,e=!0){try{let r=new Blob([s],{type:"text/plain"}).stream().pipeThrough(new CompressionStream("gzip"));return await new Response(r).blob()}catch(t){return e&&console.error("Failed to gzip compress data",t),null}}var b=class extends Error{constructor(e,t){super("HTTP error while fetching PostHog: status="+e.status+", reqByteLength="+t),this.response=e,this.reqByteLength=t,this.name="PostHogFetchHttpError"}get status(){return this.response.status}get text(){return this.response.text()}get json(){return this.response.json()}},S=class extends Error{constructor(e){super("Network error while fetching PostHog",e instanceof Error?{cause:e}:{}),this.error=e,this.name="PostHogFetchNetworkError"}},m=(s,e)=>e!==void 0?{[s]:e}:{};async function Le(s){if(s instanceof b){let e="";try{e=await s.text}catch{}console.error(`Error while flushing PostHog: message=${s.message}, response body=${e}`,s)}else console.error("Error while flushing PostHog",s);return Promise.resolve()}function ge(s){return typeof s=="object"&&(s instanceof b||s instanceof S)}function Be(s){return typeof s=="object"&&s instanceof b&&s.status===413}var pe=(function(s){return s.FeatureFlags="feature_flags",s.Recordings="recordings",s})({}),V=class{constructor(e,t={}){this.flushPromise=null,this.shutdownPromise=null,this.promiseQueue=new j,this._events=new K,this._isInitialized=!1,$e(e,"You must pass your PostHog project's api key."),this.apiKey=e,this.host=Ne(t.host||"https://us.i.posthog.com"),this.flushAt=t.flushAt?Math.max(t.flushAt,1):20,this.maxBatchSize=Math.max(this.flushAt,t.maxBatchSize??100),this.maxQueueSize=Math.max(this.flushAt,t.maxQueueSize??1e3),this.flushInterval=t.flushInterval??1e4,this.preloadFeatureFlags=t.preloadFeatureFlags??!0,this.defaultOptIn=t.defaultOptIn??!0,this.disableSurveys=t.disableSurveys??!1,this._retryOptions={retryCount:t.fetchRetryCount??3,retryDelay:t.fetchRetryDelay??3e3,retryCheck:ge},this.requestTimeout=t.requestTimeout??1e4,this.featureFlagsRequestTimeoutMs=t.featureFlagsRequestTimeoutMs??3e3,this.remoteConfigRequestTimeoutMs=t.remoteConfigRequestTimeoutMs??3e3,this.disableGeoip=t.disableGeoip??!0,this.disabled=t.disabled??!1,this.historicalMigration=t?.historicalMigration??!1,this._initPromise=Promise.resolve(),this._isInitialized=!0,this._logger=we("[PostHog]",this.logMsgIfDebug.bind(this)),this.evaluationContexts=t?.evaluationContexts??t?.evaluationEnvironments,t?.evaluationEnvironments&&!t?.evaluationContexts&&this._logger.warn("evaluationEnvironments is deprecated. Use evaluationContexts instead. This property will be removed in a future version."),this.disableCompression=!Me()||(t?.disableCompression??!1)}logMsgIfDebug(e){this.isDebug&&e()}wrap(e){if(this.disabled)return void this._logger.warn("The client is disabled");if(this._isInitialized)return e();this._initPromise.then(()=>e())}getCommonEventProperties(){return{$lib:this.getLibraryId(),$lib_version:this.getLibraryVersion()}}get optedOut(){return this.getPersistedProperty(a.OptedOut)??!this.defaultOptIn}async optIn(){this.wrap(()=>{this.setPersistedProperty(a.OptedOut,!1)})}async optOut(){this.wrap(()=>{this.setPersistedProperty(a.OptedOut,!0)})}on(e,t){return this._events.on(e,t)}debug(e=!0){if(this.removeDebugCallback?.(),e){let t=this.on("*",(r,i)=>this._logger.info(r,i));this.removeDebugCallback=()=>{t(),this.removeDebugCallback=void 0}}}get isDebug(){return!!this.removeDebugCallback}get isDisabled(){return this.disabled}buildPayload(e){return{distinct_id:e.distinct_id,event:e.event,properties:{...e.properties||{},...this.getCommonEventProperties()}}}addPendingPromise(e){return this.promiseQueue.add(e)}identifyStateless(e,t,r){this.wrap(()=>{let i={...this.buildPayload({distinct_id:e,event:"$identify",properties:t})};this.enqueue("identify",i,r)})}async identifyStatelessImmediate(e,t,r){let i={...this.buildPayload({distinct_id:e,event:"$identify",properties:t})};await this.sendImmediate("identify",i,r)}captureStateless(e,t,r,i){this.wrap(()=>{let n=this.buildPayload({distinct_id:e,event:t,properties:r});this.enqueue("capture",n,i)})}async captureStatelessImmediate(e,t,r,i){let n=this.buildPayload({distinct_id:e,event:t,properties:r});await this.sendImmediate("capture",n,i)}aliasStateless(e,t,r,i){this.wrap(()=>{let n=this.buildPayload({event:"$create_alias",distinct_id:t,properties:{...r||{},distinct_id:t,alias:e}});this.enqueue("alias",n,i)})}async aliasStatelessImmediate(e,t,r,i){let n=this.buildPayload({event:"$create_alias",distinct_id:t,properties:{...r||{},distinct_id:t,alias:e}});await this.sendImmediate("alias",n,i)}groupIdentifyStateless(e,t,r,i,n,o){this.wrap(()=>{let l=this.buildPayload({distinct_id:n||`$${e}_${t}`,event:"$groupidentify",properties:{$group_type:e,$group_key:t,$group_set:r||{},...o||{}}});this.enqueue("capture",l,i)})}async getRemoteConfig(){await this._initPromise;let e=this.host;e==="https://us.i.posthog.com"?e="https://us-assets.i.posthog.com":e==="https://eu.i.posthog.com"&&(e="https://eu-assets.i.posthog.com");let t=`${e}/array/${this.apiKey}/config`,r={method:"GET",headers:{...this.getCustomHeaders(),"Content-Type":"application/json"}};return this.fetchWithRetry(t,r,{retryCount:0},this.remoteConfigRequestTimeoutMs).then(i=>i.json()).catch(i=>{this._logger.error("Remote config could not be loaded",i),this._events.emit("error",i)})}async getFlags(e,t={},r={},i={},n={},o=!0){await this._initPromise;let l=o?"&config=true":"",u=`${this.host}/flags/?v=2${l}`,f={token:this.apiKey,distinct_id:e,groups:t,person_properties:r,group_properties:i,...n};this.evaluationContexts&&this.evaluationContexts.length>0&&(f.evaluation_contexts=this.evaluationContexts);let p={method:"POST",headers:{...this.getCustomHeaders(),"Content-Type":"application/json"},body:JSON.stringify(f)};return this._logger.info("Flags URL",u),this.fetchWithRetry(u,p,{retryCount:0},this.featureFlagsRequestTimeoutMs).then(c=>c.json()).then(c=>({success:!0,response:v(c)})).catch(c=>(this._events.emit("error",c),{success:!1,error:this.categorizeRequestError(c)}))}categorizeRequestError(e){if(e instanceof b)return{type:"api_error",statusCode:e.status};if(e instanceof S){let t=e.error;return t instanceof Error&&(t.name==="AbortError"||t.name==="TimeoutError")?{type:"timeout"}:{type:"connection_error"}}return{type:"unknown_error"}}async getFeatureFlagStateless(e,t,r={},i={},n={},o){await this._initPromise;let l=await this.getFeatureFlagDetailStateless(e,t,r,i,n,o);if(l===void 0)return{response:void 0,requestId:void 0};let u=E(l.response);return u===void 0&&(u=!1),{response:u,requestId:l.requestId}}async getFeatureFlagDetailStateless(e,t,r={},i={},n={},o){await this._initPromise;let l=await this.getFeatureFlagDetailsStateless(t,r,i,n,o,[e]);return l===void 0?void 0:{response:l.flags[e],requestId:l.requestId,evaluatedAt:l.evaluatedAt}}async getFeatureFlagPayloadStateless(e,t,r={},i={},n={},o){await this._initPromise;let l=await this.getFeatureFlagPayloadsStateless(t,r,i,n,o,[e]);if(!l)return;let u=l[e];return u===void 0?null:u}async getFeatureFlagPayloadsStateless(e,t={},r={},i={},n,o){return await this._initPromise,(await this.getFeatureFlagsAndPayloadsStateless(e,t,r,i,n,o)).payloads}async getFeatureFlagsStateless(e,t={},r={},i={},n,o){return await this._initPromise,await this.getFeatureFlagsAndPayloadsStateless(e,t,r,i,n,o)}async getFeatureFlagsAndPayloadsStateless(e,t={},r={},i={},n,o){await this._initPromise;let l=await this.getFeatureFlagDetailsStateless(e,t,r,i,n,o);return l?{flags:l.featureFlags,payloads:l.featureFlagPayloads,requestId:l.requestId}:{flags:void 0,payloads:void 0,requestId:void 0}}async getFeatureFlagDetailsStateless(e,t={},r={},i={},n,o){await this._initPromise;let l={};(n??this.disableGeoip)&&(l.geoip_disable=!0),o&&(l.flag_keys_to_evaluate=o);let u=await this.getFlags(e,t,r,i,l);if(!u.success)return;let f=u.response;return f.errorsWhileComputingFlags&&console.error("[FEATURE FLAGS] Error while computing feature flags, some flags may be missing or incorrect. Learn more at https://posthog.com/docs/feature-flags/best-practices"),f.quotaLimited?.includes("feature_flags")?(console.warn("[FEATURE FLAGS] Feature flags quota limit exceeded - feature flags unavailable. Learn more about billing limits at https://posthog.com/docs/billing/limits-alerts"),{flags:{},featureFlags:{},featureFlagPayloads:{},requestId:f?.requestId,quotaLimited:f.quotaLimited}):f}async getSurveysStateless(){if(await this._initPromise,this.disableSurveys===!0)return this._logger.info("Loading surveys is disabled."),[];let e=`${this.host}/api/surveys/?token=${this.apiKey}`,t={method:"GET",headers:{...this.getCustomHeaders(),"Content-Type":"application/json"}},i=(await this.fetchWithRetry(e,t).then(n=>{if(n.status!==200||!n.json){let o=`Surveys API could not be loaded: ${n.status}`,l=new Error(o);this._logger.error(l),this._events.emit("error",new Error(o));return}return n.json()}).catch(n=>{this._logger.error("Surveys API could not be loaded",n),this._events.emit("error",n)}))?.surveys;return i&&this._logger.info("Surveys fetched from API: ",JSON.stringify(i)),i??[]}get props(){return this._props||(this._props=this.getPersistedProperty(a.Props)),this._props||{}}set props(e){this._props=e}async register(e){this.wrap(()=>{this.props={...this.props,...e},this.setPersistedProperty(a.Props,this.props)})}async unregister(e){this.wrap(()=>{delete this.props[e],this.setPersistedProperty(a.Props,this.props)})}processBeforeEnqueue(e){return e}async flushStorage(){}enqueue(e,t,r){this.wrap(()=>{if(this.optedOut)return void this._events.emit(e,"Library is disabled. Not sending event. To re-enable, call posthog.optIn()");let i=this.prepareMessage(e,t,r);if(i=this.processBeforeEnqueue(i),i===null)return;let n=this.getPersistedProperty(a.Queue)||[];n.length>=this.maxQueueSize&&(n.shift(),this._logger.info("Queue is full, the oldest event is dropped.")),n.push({message:i}),this.setPersistedProperty(a.Queue,n),this._events.emit(e,i),n.length>=this.flushAt&&this.flushBackground(),this.flushInterval&&!this._flushTimer&&(this._flushTimer=fe(()=>this.flushBackground(),this.flushInterval))})}async sendImmediate(e,t,r){if(this.disabled)return void this._logger.warn("The client is disabled");if(this._isInitialized||await this._initPromise,this.optedOut)return void this._events.emit(e,"Library is disabled. Not sending event. To re-enable, call posthog.optIn()");let i=this.prepareMessage(e,t,r);if(i=this.processBeforeEnqueue(i),i===null)return;let n={api_key:this.apiKey,batch:[i],sent_at:G()};this.historicalMigration&&(n.historical_migration=!0);let o=JSON.stringify(n),l=`${this.host}/batch/`,u=this.disableCompression?null:await de(o,this.isDebug),f={method:"POST",headers:{...this.getCustomHeaders(),"Content-Type":"application/json",...u!==null&&{"Content-Encoding":"gzip"}},body:u||o};try{await this.fetchWithRetry(l,f)}catch(p){this._events.emit("error",p)}}prepareMessage(e,t,r){let i={...t,type:e,library:this.getLibraryId(),library_version:this.getLibraryVersion(),timestamp:r?.timestamp?r?.timestamp:G(),uuid:r?.uuid?r.uuid:y()};return(r?.disableGeoip??this.disableGeoip)&&(i.properties||(i.properties={}),i.properties.$geoip_disable=!0),i.distinctId&&(i.distinct_id=i.distinctId,delete i.distinctId),i}clearFlushTimer(){this._flushTimer&&(clearTimeout(this._flushTimer),this._flushTimer=void 0)}flushBackground(){this.flush().catch(async e=>{await Le(e)})}async flush(){let e=he([this.flushPromise]).then(()=>this._flush());return this.flushPromise=e,this.addPendingPromise(e),he([e]).then(()=>{this.flushPromise===e&&(this.flushPromise=null)}),e}getCustomHeaders(){let e=this.getCustomUserAgent(),t={};return e&&e!==""&&(t["User-Agent"]=e),t}async _flush(){this.clearFlushTimer(),await this._initPromise;let e=this.getPersistedProperty(a.Queue)||[];if(!e.length)return;let t=[],r=e.length;for(;e.length>0&&t.length<r;){let i=e.slice(0,this.maxBatchSize),n=i.map(d=>d.message),o=async()=>{let F=(this.getPersistedProperty(a.Queue)||[]).slice(i.length);this.setPersistedProperty(a.Queue,F),e=F,await this.flushStorage()},l={api_key:this.apiKey,batch:n,sent_at:G()};this.historicalMigration&&(l.historical_migration=!0);let u=JSON.stringify(l),f=`${this.host}/batch/`,p=this.disableCompression?null:await de(u,this.isDebug),c={method:"POST",headers:{...this.getCustomHeaders(),"Content-Type":"application/json",...p!==null&&{"Content-Encoding":"gzip"}},body:p||u},P={retryCheck:d=>Be(d)?!1:ge(d)};try{await this.fetchWithRetry(f,c,P)}catch(d){if(Be(d)&&n.length>1){this.maxBatchSize=Math.max(1,Math.floor(n.length/2)),this._logger.warn(`Received 413 when sending batch of size ${n.length}, reducing batch size to ${this.maxBatchSize}`);continue}throw d instanceof S||await o(),this._events.emit("error",d),d}await o(),t.push(...n)}this._events.emit("flush",t)}async fetchWithRetry(e,t,r,i){AbortSignal.timeout??=function(l){let u=new AbortController;return setTimeout(()=>u.abort(),l),u.signal};let n=t.body?t.body:"",o=-1;try{o=n instanceof Blob?n.size:Buffer.byteLength(n,ke)}catch{n instanceof Blob?o=n.size:o=new TextEncoder().encode(n).length}return await Ae(async()=>{let l=null;try{l=await this.fetch(e,{signal:AbortSignal.timeout(i??this.requestTimeout),...t})}catch(f){throw new S(f)}if(!(t.mode==="no-cors")&&(l.status<200||l.status>=400))throw new b(l,o);return l},{...this._retryOptions,...r})}async _shutdown(e=3e4){await this._initPromise;let t=!1;this.clearFlushTimer();let r=async()=>{try{for(await this.promiseQueue.join();!((this.getPersistedProperty(a.Queue)||[]).length===0||(await this.flush(),t)););}catch(i){if(!ge(i))throw i;await Le(i)}};return Promise.race([new Promise((i,n)=>{fe(()=>{this._logger.error("Timed out while shutting down PostHog"),t=!0,n("Timeout while shutting down PostHog. Some events may not have been sent.")},e)}),r()])}async shutdown(e=3e4){return this.shutdownPromise?this._logger.warn("shutdown() called while already shutting down. shutdown() is meant to be called once before process exit - use flush() for per-request cleanup"):this.shutdownPromise=this._shutdown(e).finally(()=>{this.shutdownPromise=null}),this.shutdownPromise}};var X=class extends V{constructor(e,t){let r=t?.disableGeoip??!1,i=t?.featureFlagsRequestTimeoutMs??1e4;super(e,{...t,disableGeoip:r,featureFlagsRequestTimeoutMs:i}),this.flagCallReported={},this._sessionMaxLengthSeconds=86400,this.sessionProps={},this._cachedPersonProperties=null,this.sendFeatureFlagEvent=t?.sendFeatureFlagEvent??!0,this._sessionExpirationTimeSeconds=t?.sessionExpirationTimeSeconds??1800,this._personProfiles=t?.personProfiles??"identified_only",this._beforeSend=t?.before_send}setupBootstrap(e){let t=e?.bootstrap;if(!t)return;t.distinctId&&(t.isIdentifiedId?this.getPersistedProperty(a.DistinctId)||(this.setPersistedProperty(a.DistinctId,t.distinctId),this.setPersistedProperty(a.PersonMode,"identified")):this.getPersistedProperty(a.AnonymousId)||this.setPersistedProperty(a.AnonymousId,t.distinctId));let r=t.featureFlags,i=t.featureFlagPayloads??{};if(r&&Object.keys(r).length){let n=Z(r,i);if(Object.keys(n.flags).length>0){this.setBootstrappedFeatureFlagDetails(n);let o=this.getKnownFeatureFlagDetails()||{flags:{},requestId:void 0},l={flags:{...n.flags,...o.flags},requestId:n.requestId};this.setKnownFeatureFlagDetails(l)}}}clearProps(){this.props=void 0,this.sessionProps={},this.flagCallReported={}}on(e,t){return this._events.on(e,t)}reset(e){this.wrap(()=>{let t=[a.Queue,...e||[]];this.clearProps(),this._cachedPersonProperties=null;for(let r of Object.keys(a))t.includes(a[r])||this.setPersistedProperty(a[r],null);this.reloadFeatureFlags()})}getCommonEventProperties(){let e=this.getFeatureFlags(),t={};if(e)for(let[r,i]of Object.entries(e))t[`$feature/${r}`]=i;return{...m("$active_feature_flags",e?Object.keys(e):void 0),...t,...super.getCommonEventProperties()}}enrichProperties(e){return{...this.props,...this.sessionProps,...e||{},...this.getCommonEventProperties(),$session_id:this.getSessionId()}}getSessionId(){if(!this._isInitialized)return"";let e=this.getPersistedProperty(a.SessionId),t=this.getPersistedProperty(a.SessionLastTimestamp)||0,r=this.getPersistedProperty(a.SessionStartTimestamp)||0,i=Date.now(),n=i-t,o=i-r;return(!e||n>1e3*this._sessionExpirationTimeSeconds||o>1e3*this._sessionMaxLengthSeconds)&&(e=y(),this.setPersistedProperty(a.SessionId,e),this.setPersistedProperty(a.SessionStartTimestamp,i)),this.setPersistedProperty(a.SessionLastTimestamp,i),e}resetSessionId(){this.wrap(()=>{this.setPersistedProperty(a.SessionId,null),this.setPersistedProperty(a.SessionLastTimestamp,null),this.setPersistedProperty(a.SessionStartTimestamp,null)})}getAnonymousId(){if(!this._isInitialized)return"";let e=this.getPersistedProperty(a.AnonymousId);return e||(e=y(),this.setPersistedProperty(a.AnonymousId,e)),e}getDistinctId(){return this._isInitialized?this.getPersistedProperty(a.DistinctId)||this.getAnonymousId():""}registerForSession(e){this.sessionProps={...this.sessionProps,...e}}unregisterForSession(e){delete this.sessionProps[e]}identify(e,t,r){this.wrap(()=>{if(!this._requirePersonProcessing("posthog.identify"))return;let i=this.getDistinctId();e=e||i,t?.$groups&&this.groups(t.$groups);let n=t?.$set_once;delete t?.$set_once;let o=t?.$set||t,l=this.enrichProperties({$anon_distinct_id:this.getAnonymousId(),...m("$set",o),...m("$set_once",n)}),u=M(o)?o:void 0,f=M(n)?n:void 0;e!==i?(this.setPersistedProperty(a.AnonymousId,i),this.setPersistedProperty(a.DistinctId,e),this.setPersistedProperty(a.PersonMode,"identified"),this.reloadFeatureFlags(),super.identifyStateless(e,l,r),this._cachedPersonProperties=re(e,u,f)):(u||f)&&this.setPersonProperties(u,f)})}capture(e,t,r){e==="$exception"&&!r?._originatedFromCaptureException&&this._logger.warn("Using `posthog.capture('$exception')` is unreliable because it does not attach required metadata. Use `posthog.captureException(error)` instead, which attaches required metadata automatically."),this.wrap(()=>{let i=this.getDistinctId();t?.$groups&&this.groups(t.$groups);let n=this.enrichProperties(t),o=this._hasPersonProcessing();n.$process_person_profile=o,n.$is_identified=this._isIdentified(),o&&this._requirePersonProcessing("capture"),super.captureStateless(i,e,n,r)})}alias(e){this.wrap(()=>{if(!this._requirePersonProcessing("posthog.alias"))return;let t=this.getDistinctId(),r=this.enrichProperties({});super.aliasStateless(e,t,r)})}autocapture(e,t,r={},i){this.wrap(()=>{let o={distinct_id:this.getDistinctId(),event:"$autocapture",properties:{...this.enrichProperties(r),$event_type:e,$elements:t}};this.enqueue("autocapture",o,i)})}groups(e){this.wrap(()=>{if(!this._requirePersonProcessing("posthog.group"))return;let t=this.props.$groups||{};this.register({$groups:{...t,...e}}),Object.keys(e).find(r=>t[r]!==e[r])&&this.reloadFeatureFlags()})}group(e,t,r,i){this.wrap(()=>{this.groups({[e]:t}),r&&this.groupIdentify(e,t,r,i)})}groupIdentify(e,t,r,i){this.wrap(()=>{if(!this._requirePersonProcessing("posthog.groupIdentify"))return;let n=this.getDistinctId(),o=this.enrichProperties({});super.groupIdentifyStateless(e,t,r,i,n,o)})}setPersonPropertiesForFlags(e,t=!0){this.wrap(()=>{let r=this.getPersistedProperty(a.PersonProperties)||{};this.setPersistedProperty(a.PersonProperties,{...r,...e}),t&&this.reloadFeatureFlags()})}resetPersonPropertiesForFlags(){this.wrap(()=>{this.setPersistedProperty(a.PersonProperties,null)})}setGroupPropertiesForFlags(e){this.wrap(()=>{let t=this.getPersistedProperty(a.GroupProperties)||{};Object.keys(t).length!==0&&Object.keys(t).forEach(r=>{t[r]={...t[r],...e[r]},delete e[r]}),this.setPersistedProperty(a.GroupProperties,{...t,...e})})}resetGroupPropertiesForFlags(){this.wrap(()=>{this.setPersistedProperty(a.GroupProperties,null)})}async remoteConfigAsync(){return await this._initPromise,this._remoteConfigResponsePromise?this._remoteConfigResponsePromise:this._remoteConfigAsync()}async flagsAsync(e){let{sendAnonDistinctId:t=!0,fetchConfig:r=!1,triggerOnRemoteConfig:i=!1}=e??{};return await this._initPromise,this._flagsResponsePromise?(this._logger.info("Feature flags are being loaded already, queuing reload."),this._pendingFlagsRequest&&this._flagsResponsePromise.then(this._pendingFlagsRequest.resolve).catch(this._pendingFlagsRequest.reject),new Promise((n,o)=>{this._pendingFlagsRequest={sendAnonDistinctId:t,fetchConfig:r,triggerOnRemoteConfig:i,resolve:n,reject:o}})):this._flagsAsync({sendAnonDistinctId:t,fetchConfig:r,triggerOnRemoteConfig:i})}onRemoteConfig(e){}maybeNotifyRemoteConfig(e,t){if(e)try{this.onRemoteConfig(t)}catch(r){this._logger.error("Error in onRemoteConfig callback:",r)}}cacheSessionReplay(e,t){let r=t?.sessionRecording;r?(this.setPersistedProperty(a.SessionReplay,r),this._logger.info(`Session replay config from ${e}: `,JSON.stringify(r))):typeof r=="boolean"&&r===!1&&(this._logger.info(`Session replay config from ${e} disabled.`),this.setPersistedProperty(a.SessionReplay,null))}async _remoteConfigAsync(){return this._remoteConfigResponsePromise=this._initPromise.then(()=>{let e=this.getPersistedProperty(a.RemoteConfig);return this._logger.info("Cached remote config: ",JSON.stringify(e)),super.getRemoteConfig().then(t=>{if(t){let r={...t};if(delete r.surveys,this._logger.info("Fetched remote config: ",JSON.stringify(r)),this.disableSurveys===!1){let n=t.surveys,o=!0;Array.isArray(n)?this._logger.info("Surveys fetched from remote config: ",JSON.stringify(n)):(this._logger.info("There are no surveys."),o=!1),o?this.setPersistedProperty(a.Surveys,n):this.setPersistedProperty(a.Surveys,null)}else this.setPersistedProperty(a.Surveys,null);this.setPersistedProperty(a.RemoteConfig,r),this.cacheSessionReplay("remote config",t);let i=!1;t.hasFeatureFlags===!1?(this.setKnownFeatureFlagDetails({flags:{}}),this._logger.warn("Remote config has no feature flags, will not load feature flags.")):this.preloadFeatureFlags!==!1&&(i=!0,this.flagsAsync({sendAnonDistinctId:!0,fetchConfig:!0,triggerOnRemoteConfig:!0})),t.supportedCompression?.includes(be.GZipJS)||(this.disableCompression=!0),this.maybeNotifyRemoteConfig(!i,t),e=t}return e})}).finally(()=>{this._remoteConfigResponsePromise=void 0}),this._remoteConfigResponsePromise}async _flagsAsync(e){let t=e?.sendAnonDistinctId??!0,r=e?.fetchConfig??!1,i=e?.triggerOnRemoteConfig??!1;return this._flagsResponsePromise=this._initPromise.then(async()=>{let n=this.getDistinctId(),o=this.props.$groups||{},l=this.getPersistedProperty(a.PersonProperties)||{},u=this.getPersistedProperty(a.GroupProperties)||{},f={$anon_distinct_id:t?this.getAnonymousId():void 0},p=await super.getFlags(n,o,l,u,f,r);if(!p.success)return void this.setKnownFeatureFlagDetails({flags:this.getKnownFeatureFlagDetails()?.flags??{},requestError:p.error});let c=p.response;if(c?.quotaLimited?.includes(pe.FeatureFlags))return this.setKnownFeatureFlagDetails({flags:this.getKnownFeatureFlagDetails()?.flags??{},quotaLimited:c.quotaLimited}),this._logger.warn("[FEATURE FLAGS] Feature flags quota limit exceeded. Learn more about billing limits at https://posthog.com/docs/billing/limits-alerts"),this.maybeNotifyRemoteConfig(i,c),c;if(c?.featureFlags){this.sendFeatureFlagEvent&&(this.flagCallReported={});let P=c;if(c.errorsWhileComputingFlags){let d=this.getKnownFeatureFlagDetails();this._logger.info("Cached feature flags: ",JSON.stringify(d));let F={};for(let O in c.flags)c.flags[O].failed||(F[O]=c.flags[O]);P={...c,flags:{...d?.flags,...F}}}this.setKnownFeatureFlagDetails({flags:P.flags,requestId:c.requestId,evaluatedAt:c.evaluatedAt,errorsWhileComputingFlags:c.errorsWhileComputingFlags,quotaLimited:c.quotaLimited}),this.setPersistedProperty(a.FlagsEndpointWasHit,!0),this.cacheSessionReplay("flags",c),this.maybeNotifyRemoteConfig(i,c)}return c}).finally(()=>{this._flagsResponsePromise=void 0;let n=this._pendingFlagsRequest;n&&(this._pendingFlagsRequest=void 0,this._logger.info("Executing pending feature flags reload."),this.flagsAsync({sendAnonDistinctId:n.sendAnonDistinctId,fetchConfig:n.fetchConfig,triggerOnRemoteConfig:n.triggerOnRemoteConfig}).then(n.resolve).catch(n.reject))}),this._flagsResponsePromise}setKnownFeatureFlagDetails(e){this.wrap(()=>{this.setPersistedProperty(a.FeatureFlagDetails,e),this._events.emit("featureflags",R(e?.flags??{}))})}getKnownFeatureFlagDetails(){let e=this.getPersistedProperty(a.FeatureFlagDetails);if(!e){let t=this.getPersistedProperty(a.FeatureFlags),r=this.getPersistedProperty(a.FeatureFlagPayloads);return t===void 0&&r===void 0?void 0:Z(t??{},r??{})}return v(e)}getStoredFlagDetails(){return this.getPersistedProperty(a.FeatureFlagDetails)}getKnownFeatureFlags(){let e=this.getKnownFeatureFlagDetails();if(e)return R(e.flags)}getBootstrappedFeatureFlagDetails(){let e=this.getPersistedProperty(a.BootstrapFeatureFlagDetails);if(e)return e}setBootstrappedFeatureFlagDetails(e){this.setPersistedProperty(a.BootstrapFeatureFlagDetails,e)}getBootstrappedFeatureFlags(){let e=this.getBootstrappedFeatureFlagDetails();if(e)return R(e.flags)}getBootstrappedFeatureFlagPayloads(){let e=this.getBootstrappedFeatureFlagDetails();if(e)return Y(e.flags)}getFeatureFlagResult(e,t){return this._getFeatureFlagResult(e,t)}_getFeatureFlagResult(e,t={}){let r=this.getStoredFlagDetails(),i=this.getFeatureFlagDetails(),n=r?.quotaLimited?.includes(pe.FeatureFlags),o=i?.flags[e],l=(t.sendEvent??this.sendFeatureFlagEvent)&&!this.flagCallReported[e],u=E(o);if(l){let c=[];if(r?.requestError){let{type:H,statusCode:ye}=r.requestError;H==="timeout"?c.push(_.TIMEOUT):H==="api_error"&&ye!==void 0?c.push(_.apiError(ye)):H==="connection_error"?c.push(_.CONNECTION_ERROR):c.push(_.UNKNOWN_ERROR)}else r&&(r.errorsWhileComputingFlags&&c.push(_.ERRORS_WHILE_COMPUTING),n?c.push(_.QUOTA_LIMITED):u===void 0&&!o&&c.push(_.FLAG_MISSING));let P=this.getBootstrappedFeatureFlags()?.[e],d=this.getBootstrappedFeatureFlagPayloads()?.[e],F=c.length>0?c.join(","):void 0;this.flagCallReported[e]=!0;let O={$feature_flag:e,$feature_flag_response:u,...m("$feature_flag_id",o?.metadata?.id),...m("$feature_flag_version",o?.metadata?.version),...m("$feature_flag_reason",o?.reason?.description??o?.reason?.code),...m("$feature_flag_bootstrapped_response",P),...m("$feature_flag_bootstrapped_payload",d),$used_bootstrap_value:!this.getPersistedProperty(a.FlagsEndpointWasHit),...m("$feature_flag_request_id",i?.requestId),...m("$feature_flag_evaluated_at",i?.evaluatedAt),...m("$feature_flag_error",F)};this.capture("$feature_flag_called",O)}if(u===void 0)switch(t.missingFlagBehavior){case"getFeatureFlagPayload":return i?{key:e,enabled:!1,payload:null}:void 0;case"getFeatureFlag":return i&&Object.keys(i.flags).length?{key:e,enabled:!1,payload:null}:void 0;case void 0:return}let f=o?.metadata?.payload,p=f!==void 0?N(f):null;return{key:e,enabled:ee(u),variant:te(u),payload:p}}getFeatureFlag(e){let t=this._getFeatureFlagResult(e,{missingFlagBehavior:"getFeatureFlag"});return t?.variant??t?.enabled}getFeatureFlagPayload(e){return this._getFeatureFlagResult(e,{missingFlagBehavior:"getFeatureFlagPayload",sendEvent:!1})?.payload}getFeatureFlagPayloads(){return this.getFeatureFlagDetails()?.featureFlagPayloads}getFeatureFlags(){return this.getFeatureFlagDetails()?.featureFlags}getFeatureFlagDetails(){let e=this.getKnownFeatureFlagDetails(),t=this.getPersistedProperty(a.OverrideFeatureFlags);if(!t)return e;e=e??{featureFlags:{},featureFlagPayloads:{},flags:{}};let r=e.flags??{};for(let n in t)t[n]?r[n]=_e(r[n],t[n]):delete r[n];let i={...e,flags:r};return v(i)}getFeatureFlagsAndPayloads(){let e=this.getFeatureFlags(),t=this.getFeatureFlagPayloads();return{flags:e,payloads:t}}isFeatureEnabled(e){let t=this.getFeatureFlag(e);if(t!==void 0)return!!t}reloadFeatureFlags(e){this.flagsAsync({sendAnonDistinctId:!0}).then(t=>{e?.cb?.(void 0,t?.featureFlags)}).catch(t=>{e?.cb?.(t,void 0),e?.cb||this._logger.info("Error reloading feature flags",t)})}async reloadRemoteConfigAsync(){return await this.remoteConfigAsync()}async reloadFeatureFlagsAsync(e){return(await this.flagsAsync({sendAnonDistinctId:e}))?.featureFlags}onFeatureFlags(e){return this.on("featureflags",async()=>{let t=this.getFeatureFlags();t&&e(t)})}onFeatureFlag(e,t){return this.on("featureflags",async()=>{let r=this.getFeatureFlag(e);r!==void 0&&t(r)})}async overrideFeatureFlag(e){this.wrap(()=>e===null?this.setPersistedProperty(a.OverrideFeatureFlags,null):this.setPersistedProperty(a.OverrideFeatureFlags,e))}captureException(e,t){let r={$exception_level:"error",$exception_list:[{type:B(e)?e.name:"Error",value:B(e)?e.message:e,mechanism:{handled:!0,synthetic:!1}}],...t};this.capture("$exception",r,{_originatedFromCaptureException:!0})}captureTraceFeedback(e,t){this.capture("$ai_feedback",{$ai_feedback_text:t,$ai_trace_id:String(e)})}captureTraceMetric(e,t,r){this.capture("$ai_metric",{$ai_metric_name:t,$ai_metric_value:String(r),$ai_trace_id:String(e)})}_isIdentified(){let e=this.getPersistedProperty(a.PersonMode);if(e==="identified")return!0;if(e===void 0){let t=this.getPersistedProperty(a.DistinctId),r=this.getPersistedProperty(a.AnonymousId);if(t&&r&&t!==r)return!0}return!1}_getGroups(){return this.props.$groups||{}}_hasPersonProcessing(){if(this._personProfiles==="always")return!0;if(this._personProfiles==="never")return!1;let e=this._isIdentified(),t=Object.keys(this._getGroups()).length>0,r=this.getPersistedProperty(a.EnablePersonProcessing)===!0;return e||t||r}_requirePersonProcessing(e){return this._personProfiles==="never"?(this._logger.error(`${e} was called, but personProfiles is set to "never". This call will be ignored.`),!1):(this.setPersistedProperty(a.EnablePersonProcessing,!0),!0)}createPersonProfile(){this._hasPersonProcessing()||this._requirePersonProcessing("posthog.createPersonProfile")&&this.capture("$set",{$set:{},$set_once:{}})}setPersonProperties(e,t,r=!0){this.wrap(()=>{let i=ne(e)||ie(e),n=ne(t)||ie(t);if(i&&n||!this._requirePersonProcessing("posthog.setPersonProperties"))return;let o=re(this.getDistinctId(),e,t);if(this._cachedPersonProperties===o)return void this._logger.info("A duplicate setPersonProperties call was made with the same properties. It has been ignored.");let l={...t||{},...e||{}};this.setPersonPropertiesForFlags(l,r),this.capture("$set",{$set:e||{},$set_once:t||{}}),this._cachedPersonProperties=o})}processBeforeEnqueue(e){if(!this._beforeSend)return e;let t=e.timestamp,r=e.properties||{},i={uuid:e.uuid,event:e.event,properties:r,$set:r.$set,$set_once:r.$set_once,timestamp:typeof t=="string"?new Date(t):t},n=this._runBeforeSend(i);if(!n)return null;let o={...n.properties??r};return n.$set!==void 0?o.$set=n.$set:delete o.$set,n.$set_once!==void 0?o.$set_once=n.$set_once:delete o.$set_once,{...e,uuid:n.uuid??e.uuid,event:n.event,properties:o,timestamp:n.timestamp}}_runBeforeSend(e){let t=this._beforeSend;if(!t)return e;let r=Array.isArray(t)?t:[t],i=e;for(let n of r)try{if(i=n(i),!i)return this._logger.info(`Event '${e.event}' was rejected in before_send function`),null}catch(o){this._logger.error(`Error in before_send function for event '${e.event}':`,o)}return i}};var We="4.5.2";function wt(s){let e={};if(s?.navigator){let t=s.navigator.userAgent,r=St(s);e={...e,...r!==void 0&&{$os:r},$browser:ze(t,s.navigator.vendor,!!s.opera),$referrer:s.document.referrer,$referring_domain:Ot(s.document.referrer),$device:It(t),$current_url:s.location.href,$host:s.location.host,$pathname:s.location.pathname,$browser_version:xt(t,s.navigator.vendor,!!s.opera),$screen_height:s.screen.height,$screen_width:s.screen.width,$screen_dpr:s.devicePixelRatio}}return e={...e,$lib:"js",$lib_version:We,$insert_id:Math.random().toString(36).substring(2,10)+Math.random().toString(36).substring(2,10),$time:De()/1e3},e}function h(s,e){return s.indexOf(e)>=0}function ze(s,e,t){return e=e||"",t||h(s," OPR/")?h(s,"Mini")?"Opera Mini":"Opera":/(BlackBerry|PlayBook|BB10)/i.test(s)?"BlackBerry":h(s,"IEMobile")||h(s,"WPDesktop")?"Internet Explorer Mobile":h(s,"SamsungBrowser/")?"Samsung Internet":h(s,"Edge")||h(s,"Edg/")?"Microsoft Edge":h(s,"FBIOS")?"Facebook Mobile":h(s,"Chrome")?"Chrome":h(s,"CriOS")?"Chrome iOS":h(s,"UCWEB")||h(s,"UCBrowser")?"UC Browser":h(s,"FxiOS")?"Firefox iOS":h(e,"Apple")?h(s,"Mobile")?"Mobile Safari":"Safari":h(s,"Android")?"Android Mobile":h(s,"Konqueror")?"Konqueror":h(s,"Firefox")?"Firefox":h(s,"MSIE")||h(s,"Trident/")?"Internet Explorer":h(s,"Gecko")?"Mozilla":""}function xt(s,e,t){let r={"Internet Explorer Mobile":/rv:(\d+(\.\d+)?)/,"Microsoft Edge":/Edge?\/(\d+(\.\d+)?)/,Chrome:/Chrome\/(\d+(\.\d+)?)/,"Chrome iOS":/CriOS\/(\d+(\.\d+)?)/,"UC Browser":/(UCBrowser|UCWEB)\/(\d+(\.\d+)?)/,Safari:/Version\/(\d+(\.\d+)?)/,"Mobile Safari":/Version\/(\d+(\.\d+)?)/,Opera:/(Opera|OPR)\/(\d+(\.\d+)?)/,Firefox:/Firefox\/(\d+(\.\d+)?)/,"Firefox iOS":/FxiOS\/(\d+(\.\d+)?)/,Konqueror:/Konqueror:(\d+(\.\d+)?)/,BlackBerry:/BlackBerry (\d+(\.\d+)?)/,"Android Mobile":/android\s(\d+(\.\d+)?)/,"Samsung Internet":/SamsungBrowser\/(\d+(\.\d+)?)/,"Internet Explorer":/(rv:|MSIE )(\d+(\.\d+)?)/,Mozilla:/rv:(\d+(\.\d+)?)/},i=ze(s,e,t),n=r[i]||void 0;if(n===void 0)return null;let o=s.match(n);return o?parseFloat(o[o.length-2]):null}function St(s){if(!s?.navigator)return;let e=s.navigator.userAgent;return/Windows/i.test(e)?/Phone/.test(e)||/WPDesktop/.test(e)?"Windows Phone":"Windows":/(iPhone|iPad|iPod)/.test(e)?"iOS":/Android/.test(e)?"Android":/(BlackBerry|PlayBook|BB10)/i.test(e)?"BlackBerry":/Mac/i.test(e)?"Mac OS X":/Linux/.test(e)?"Linux":/CrOS/.test(e)?"Chrome OS":void 0}function It(s){return/Windows Phone/i.test(s)||/WPDesktop/.test(s)?"Windows Phone":/iPad/.test(s)?"iPad":/iPod/.test(s)?"iPod Touch":/iPhone/.test(s)?"iPhone":/(BlackBerry|PlayBook|BB10)/i.test(s)?"BlackBerry":/Android/.test(s)?"Android":""}function Ot(s){let e=s.split("/");return e.length>=3?e[2]:""}var Ge={getItem(s){try{let e=s+"=",t=document.cookie.split(";");for(let r=0;r<t.length;r++){let i=t[r];for(;i.charAt(0)==" ";)i=i.substring(1,i.length);if(i.indexOf(e)===0)return decodeURIComponent(i.substring(e.length,i.length))}}catch{}return null},setItem(s,e){try{let n=s+"="+encodeURIComponent(e)+"; path=/";document.cookie=n}catch{return}},removeItem(s){try{Ge.setItem(s,"")}catch{return}},clear(){document.cookie=""},getAllKeys(){let s=document.cookie.split(";"),e=[];for(let t=0;t<s.length;t++){let r=s[t];for(;r.charAt(0)==" ";)r=r.substring(1,r.length);e.push(r.split("=")[0])}return e}},je=s=>({getItem(e){return s.getItem(e)},setItem(e,t){s.setItem(e,t)},removeItem(e){s.removeItem(e)},clear(){s.clear()},getAllKeys(){let e=[];for(let t in localStorage)e.push(t);return e}}),Ue=(s,e="__mplssupport__")=>{try{return s.setItem(e,"xyz"),s.getItem(e)!=="xyz"?!1:(s.removeItem(e),!0)}catch{return!1}},Q,k,$=()=>{let s={};return{getItem(t){return s[t]},setItem(t,r){s[t]=r!==null?r:void 0},removeItem(t){delete s[t]},clear(){for(let t in s)delete s[t]},getAllKeys(){let t=[];for(let r in s)t.push(r);return t}}},Rt=(s,e)=>{if(e){if(!Q){let t=je(e.localStorage);Q=Ue(t)?t:void 0}if(!k){let t=je(e.sessionStorage);k=Ue(t)?t:void 0}}switch(s){case"cookie":return Ge||Q||k||$();case"localStorage":return Q||k||$();case"sessionStorage":return k||$();case"memory":return $();default:return $()}},Ct=function(s){return typeof s=="function"};function qe(s,e,t){try{if(!(e in s))return()=>{};let r=s[e],i=t(r);return Ct(i)&&(i.prototype=i.prototype||{},Object.defineProperties(i,{__posthog_wrapped__:{enumerable:!1,value:!0}})),s[e]=i,()=>{s[e]=r}}catch{return()=>{}}}var J=class extends X{constructor(e,t){super(e,t),this._lastPathname="",this._storageKey=t?.persistence_name?`ph_${t.persistence_name}`:`ph_${e}_posthog`,this._storage=Rt(t?.persistence||"localStorage",this.getWindow()),this.setupBootstrap(t),t?.preloadFeatureFlags!==!1&&this.reloadFeatureFlags(),t?.captureHistoryEvents&&typeof window<"u"&&(this._lastPathname=window?.location?.pathname||"",this.setupHistoryEventTracking())}getWindow(){return typeof window<"u"?window:void 0}getPersistedProperty(e){return this._storageCache||(this._storageCache=JSON.parse(this._storage.getItem(this._storageKey)||"{}")||{}),this._storageCache[e]}setPersistedProperty(e,t){this._storageCache||(this._storageCache=JSON.parse(this._storage.getItem(this._storageKey)||"{}")||{}),t===null?delete this._storageCache[e]:this._storageCache[e]=t,this._storage.setItem(this._storageKey,JSON.stringify(this._storageCache))}fetch(e,t){let r=Te();return r?r(e,t):Promise.reject(new Error("Fetch API is not available in this environment."))}getLibraryId(){return"posthog-js-lite"}getLibraryVersion(){return We}getCustomUserAgent(){}getCommonEventProperties(){return{...super.getCommonEventProperties(),...wt(this.getWindow())}}setupHistoryEventTracking(){let e=this.getWindow();if(!e)return;let t=this;qe(e.history,"pushState",r=>function(n,o,l){r.call(this,n,o,l),t.captureNavigationEvent("pushState")}),qe(e.history,"replaceState",r=>function(n,o,l){r.call(this,n,o,l),t.captureNavigationEvent("replaceState")}),e.addEventListener("popstate",()=>{this.captureNavigationEvent("popstate")})}captureNavigationEvent(e){let t=this.getWindow();if(!t)return;let r=t.location.pathname;r!==this._lastPathname&&(this.capture("$pageview",{navigation_type:e}),this._lastPathname=r)}};window.PostHog=J;})();
/*! Bundled license information:

@posthog/core/dist/vendor/uuidv7.mjs:
  (*! For license information please see uuidv7.mjs.LICENSE.txt *)
  (**
   * uuidv7: An experimental implementation of the proposed UUID Version 7
   *
   * @license Apache-2.0
   * @copyright 2021-2023 LiosK
   * @packageDocumentation
   *)
*/
